
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphGridLayout &#8212; Cutter 1.10.3 documentation</title>
    <link rel="stylesheet" href="../../_static/cutter.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="GraphHorizontalAdapter" href="classGraphHorizontalAdapter.html" />
    <link rel="prev" title="FunctionsWidget" href="classFunctionsWidget.html" />

  </head><body>
    

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="classGraphHorizontalAdapter.html" title="GraphHorizontalAdapter"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="classFunctionsWidget.html" title="FunctionsWidget"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Cutter 1.10.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../api.html" >API Reference</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../widgetslist.html" accesskey="U">Widgets</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">GraphGridLayout</a></li> 
      </ul>
    </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="graphgridlayout">
<h1>GraphGridLayout<a class="headerlink" href="#graphgridlayout" title="Permalink to this headline">¶</a></h1>
<dl class="cpp class">
<dt id="_CPPv415GraphGridLayout">
<span id="_CPPv315GraphGridLayout"></span><span id="_CPPv215GraphGridLayout"></span><span id="GraphGridLayout"></span><span class="target" id="classGraphGridLayout"></span><em class="property">class </em><code class="sig-name descname">GraphGridLayout</code> : <em class="property">public</em> <a class="reference internal" href="classGraphLayout.html#_CPPv411GraphLayout" title="GraphLayout">GraphLayout</a><a class="headerlink" href="#_CPPv415GraphGridLayout" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Graph layout algorithm on layered graph layout approach. For simplicity all the nodes are placed in a grid. </p>
<p>Basic familiarity with graph algorithms is recommended.</p>
<p><em>Terms used:</em></p>
<p><ul class="simple">
<li><p><strong>Vertex</strong>, <strong>node</strong>, <strong>block</strong> - read description of graph for definition. Within this text vertex and node are used interchangeably with block due to code being written for visualizing basic block control flow graph.</p></li>
<li><p><strong>edge</strong> - read description of graph for definition for precise definition.</p></li>
<li><p><strong>DAG</strong> - directed acyclic graph, graph using directed edges which doesn’t have cycles. DAG may contain loops if following them would require going in both directions of edges. Example 1-&gt;2 1-&gt;3 3-&gt;2 is a DAG, 2-&gt;1 1-&gt;3 3-&gt;2 isn’t a DAG.</p></li>
<li><p><strong>DFS</strong> - depth first search, a graph traversal algorithm</p></li>
<li><p><strong>toposort</strong> - topological sorting, process of ordering a DAG vertices that all edges go from vertices earlier in the toposort order to vertices later in toposort order. There are multiple algorithms for implementing toposort operation. Single DAG can have multiple valid topological orderings, a toposort algorithm can be designed to prioritize a specific one from all valid toposort orders. Example: for graph 1-&gt;4, 2-&gt;1, 2-&gt;3, 3-&gt;4 valid topological orders are [2,1,3,4] and [2,3,1,4].</p></li>
</ul>
</p>
<p><em>High level structure of the algorithm</em></p>
<p><ol class="loweralpha simple">
<li><p>select subset of edges that form a DAG (remove cycles)</p></li>
<li><p>toposort the DAG</p></li>
<li><p>choose a subset of edges that form a tree and assign layers</p></li>
<li><p>assign node positions within grid using tree structure, child subtrees are placed side by side with parent on top</p></li>
<li><p>perform edge routing</p></li>
<li><p>calculate column and row pixel positions based on node sizes and amount edges between the rows</p></li>
<li><p>[optional] layout compacting</p></li>
</ol>
</p>
<p>Contrary to many other layered graph drawing algorithm this implementation doesn’t perform node reordering to minimize edge crossing. This simplifies implementation, and preserves original control flow structure for conditional jumps ( true jump on one side, false jump on other). Due to most of control flow being result of structured programming constructs like if/then/else and loops, resulting layout is usually readable without node reordering within layers.</p>
<p><em>Description of grid.</em></p>
<p>To simplify the layout algorithm initial steps assume that all nodes have the same size and edges are zero width. After placing the nodes and routing the edges it is known which nodes are in in which row and column, how many edges are between each pair of rows. Using this information positions are converted from the grid cells to pixel coordinates. Routing 0 width edges between rows can also be interpreted as every second row and column being reserved for edges. The row numbers in code are using first interpretation. To allow better centering of nodes one above other each node is 2 columns wide and 1 row high.</p>
<p><img alt="../doxygen-out/xml/graph_grid.svg" src="../doxygen-out/xml/graph_grid.svg" /></p>
<p><em>1-2 Cycle removal and toposort</em></p>
<p>Cycle removal and toposort are done at the same time during single DFS traversal. In case entrypoint is part of a loop DFS started from entrypoint. This ensures that entrypoint is at the top of resulting layout if possible. Resulting toposort order is used in many of the following layout steps that require calculating some property of a vertex based on child property or the other way around. Using toposort order such operations can be implemented iteration through array in either forward or reverse direction. To prevent running out of stack memory when processing large graphs DFS is implemented non-recursively.</p>
<p><em>Row assignment</em></p>
<p>Rows are assigned in toposort order from top to bottom, with nodes row being max(predecessor.row)+1. This ensures that loop edges are only ones going from deeper levels to previous layers.</p>
<p>To further simply node placement a subset of edges is selected which forms a tree. This turns DAG drawing problem into a tree drawing problem. For each node in level n following nodes which have level exactly n+1 are greedily assigned as child nodes in tree. If a node already has parent assigned then corresponding edge is not part of tree.</p>
<p><em>Node position assignment</em></p>
<p>Since the graph has been reduced to a tree, node placement is more or less putting subtrees side by side with parent on top. There is some room for interpretation what exactly side by side means and where exactly on top is. Drawing the graph either too dense or too big may make it less readable so there are configuration options which allow choosing these things resulting in more or less dense layout.</p>
<p>Once the subtrees are placed side by side. Parent node can be placed either in the middle of horizontal bounds or in the middle of direct children. First option results in narrower layout and more vertical columns. Second option results in nodes being more spread out which may help seeing where each edge goes.</p>
<p>In more compact mode two subtrees are placed side by side taking into account their shape. In wider mode bounding box of shorter subtree is used instead of exact shape. This gives slightly sparse layout without it being too wide.</p>
<p><img alt="../doxygen-out/xml/graph_parent_placement.svg" src="../doxygen-out/xml/graph_parent_placement.svg" /></p>
<p><em>Edge routing</em></p>
<p>Edge routing can be split into: main column selection, rough routing, segment offset calculation.</p>
<p>Transition from source to target row is done using single vertical segment. This is called main column.</p>
<p>Rough routing creates the path of edge using up to 5 segments using grid coordinates. Due to nodes being placed in a grid. Horizontal segments of edges can’t intersect with any nodes. The path for edges is chosen so that it consists of at most 5 segments, typically resulting in sideways U shape or square Z shape.<ul class="simple">
<li><p>short vertical segment from node to horizontal line</p></li>
<li><p>move to empty column</p></li>
<li><p>vertical segment between starting row and end row, an empty column can always be found, in the worst case there are empty columns at the sides of drawing</p></li>
<li><p>horizontal segment to target node column</p></li>
<li><p>short vertical segment connecting to target node</p></li>
</ul>
</p>
<p>There are 3 special cases:<ul class="simple">
<li><p>source and target nodes are in the same column with no nodes between - single vertical segment</p></li>
<li><p>column bellow stating node is empty - segments 1-3 are merged</p></li>
<li><p>column above target node is empty - segments 3-5 are merged Vertical segment intersection with nodes is prevented using a 2d array marking which vertical segments are blocked and naively iterating through all rows between start and end at the desired column.</p></li>
</ul>
</p>
<p>After rough routing segment offsets are calculated relative to their corresponding edge column. This ensures that two segments don’t overlap. Segment offsets within each column are assigned greedily with some heuristics for assignment order to reduce amount of edge crossings and result in more visually pleasing output for a typical CFG graph. Each segment gets assigned an offset that is maximum of previously assigned offsets overlapping with current segment + segment spacing. Assignment order is chosen based on: direction of previous and last segment - helps reducing crossings and place the segments between nodes segment length - reduces crossing when segment endpoints have the same structure as valid parentheses expression edge length - establishes some kind of order when single node is connected to many edges, typically a block with switch statement or block after switch statement.</p>
<p><em>Layout compacting</em></p>
<p>Doing the layout within a grid causes minimal spacing to be limited by widest and tallest block within each column and row. One common case is block with function entrypoint being wider due to function name causing wide horizontal space between branching blocks. Another case is rows in two parallel columns being aligned.</p>
<p><img alt="../doxygen-out/xml/layout_compacting.svg" src="../doxygen-out/xml/layout_compacting.svg" /></p>
<p>Both problems are mitigated by squishing graph. Compressing in each of the two direction is done separately. The process is defined as liner program. Each variable represents a position of edge segment or node in the direction being optimized.</p>
<p>Following constraints are used<ul class="simple">
<li><p>Keep the order with nearest segments.</p></li>
<li><p>If the node has two outgoing edges, one to the node on left side and other to the right, keep them on the corresponding side of node’s center.</p></li>
<li><p>For all edges keep the node which is above above. This helps when vertical block spacing is set bigger than double edge spacing and edge shadows relationship between two blocks.</p></li>
<li><p>Equality constraint to keep relative position between nodes and and segments directly connected to them.</p></li>
<li><p>Equality constraint to keep the node centered when control flow merges In the vertical direction objective function minimizes y positions of nodes and lengths of vertical segments. In the horizontal direction objective function minimizes lengths of horizontal segments.</p></li>
</ul>
</p>
<p>In the resulting linear program all constraints beside x_i &gt;= 0 consist of exactly two variables: either x_i - x_j &lt;= c_k or x_i = x_j + c_k.</p>
<p>Since it isn’t necessary get perfect solution and to avoid worst case performance current implementation isn’t using a general purpose linear programming solver. Each variable is changed until constraint is reached and afterwards variables are grouped and changed together. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Types</p>
<dl class="cpp enum">
<dt id="_CPPv4N15GraphGridLayout10LayoutTypeE">
<span id="_CPPv3N15GraphGridLayout10LayoutTypeE"></span><span id="_CPPv2N15GraphGridLayout10LayoutTypeE"></span><span class="target" id="classGraphGridLayout_1a77c7d9da9e9db2ee528d0e1e6053e12d"></span><em class="property">enum </em><code class="sig-name descname">LayoutType</code><a class="headerlink" href="#_CPPv4N15GraphGridLayout10LayoutTypeE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><em>Values:</em></p>
<dl class="cpp enumerator">
<dt id="_CPPv4N15GraphGridLayout10LayoutType6MediumE">
<span id="_CPPv3N15GraphGridLayout10LayoutType6MediumE"></span><span id="_CPPv2N15GraphGridLayout10LayoutType6MediumE"></span><span class="target" id="classGraphGridLayout_1a77c7d9da9e9db2ee528d0e1e6053e12da87f8a6ab85c9ced3702b4ea641ad4bb5"></span><em class="property">enumerator </em><code class="sig-name descname">Medium</code><a class="headerlink" href="#_CPPv4N15GraphGridLayout10LayoutType6MediumE" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp enumerator">
<dt id="_CPPv4N15GraphGridLayout10LayoutType4WideE">
<span id="_CPPv3N15GraphGridLayout10LayoutType4WideE"></span><span id="_CPPv2N15GraphGridLayout10LayoutType4WideE"></span><span class="target" id="classGraphGridLayout_1a77c7d9da9e9db2ee528d0e1e6053e12dae7c770a61dbdf81ca922ae0260e327c1"></span><em class="property">enumerator </em><code class="sig-name descname">Wide</code><a class="headerlink" href="#_CPPv4N15GraphGridLayout10LayoutType4WideE" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp enumerator">
<dt id="_CPPv4N15GraphGridLayout10LayoutType6NarrowE">
<span id="_CPPv3N15GraphGridLayout10LayoutType6NarrowE"></span><span id="_CPPv2N15GraphGridLayout10LayoutType6NarrowE"></span><span class="target" id="classGraphGridLayout_1a77c7d9da9e9db2ee528d0e1e6053e12da4a7ab319be06025840ef3389301424b9"></span><em class="property">enumerator </em><code class="sig-name descname">Narrow</code><a class="headerlink" href="#_CPPv4N15GraphGridLayout10LayoutType6NarrowE" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="cpp function">
<dt id="_CPPv4N15GraphGridLayout15GraphGridLayoutE10LayoutType">
<span id="_CPPv3N15GraphGridLayout15GraphGridLayoutE10LayoutType"></span><span id="_CPPv2N15GraphGridLayout15GraphGridLayoutE10LayoutType"></span><span id="GraphGridLayout::GraphGridLayout__LayoutType"></span><span class="target" id="classGraphGridLayout_1a387f73e1df46c6bf54c98fb219021de7"></span><code class="sig-name descname">GraphGridLayout</code><span class="sig-paren">(</span><a class="reference internal" href="#_CPPv4N15GraphGridLayout10LayoutTypeE" title="GraphGridLayout::LayoutType">LayoutType</a> <em>layoutType</em> = <a class="reference internal" href="#_CPPv4N15GraphGridLayout10LayoutTypeE" title="GraphGridLayout::LayoutType">LayoutType</a>::<a class="reference internal" href="#_CPPv4N15GraphGridLayout10LayoutType6MediumE" title="GraphGridLayout::LayoutType::Medium">Medium</a><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N15GraphGridLayout15GraphGridLayoutE10LayoutType" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp function">
<dt id="_CPPv4NK15GraphGridLayout15CalculateLayoutER5Graph4ut64RiRi">
<span id="_CPPv3NK15GraphGridLayout15CalculateLayoutER5Graph4ut64RiRi"></span><span id="_CPPv2NK15GraphGridLayout15CalculateLayoutER5Graph4ut64RiRi"></span><span id="GraphGridLayout::CalculateLayout__GraphR.ut64.iR.iRC"></span><span class="target" id="classGraphGridLayout_1a69f0749a1d9eeb4db2d83e5a8540909c"></span>void <code class="sig-name descname">CalculateLayout</code><span class="sig-paren">(</span>Graph &amp;<em>blocks</em>, ut64 <em>entry</em>, int &amp;<em>width</em>, int &amp;<em>height</em><span class="sig-paren">)</span> <em class="property">const</em> <em class="property">override</em><a class="headerlink" href="#_CPPv4NK15GraphGridLayout15CalculateLayoutER5Graph4ut64RiRi" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp function">
<dt id="_CPPv4N15GraphGridLayout24setTightSubtreePlacementEb">
<span id="_CPPv3N15GraphGridLayout24setTightSubtreePlacementEb"></span><span id="_CPPv2N15GraphGridLayout24setTightSubtreePlacementEb"></span><span id="GraphGridLayout::setTightSubtreePlacement__b"></span><span class="target" id="classGraphGridLayout_1ace65ee2d4bae3e5df223e41d3df48edc"></span>void <code class="sig-name descname">setTightSubtreePlacement</code><span class="sig-paren">(</span>bool <em>enabled</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N15GraphGridLayout24setTightSubtreePlacementEb" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp function">
<dt id="_CPPv4N15GraphGridLayout27setParentBetweenDirectChildEb">
<span id="_CPPv3N15GraphGridLayout27setParentBetweenDirectChildEb"></span><span id="_CPPv2N15GraphGridLayout27setParentBetweenDirectChildEb"></span><span id="GraphGridLayout::setParentBetweenDirectChild__b"></span><span class="target" id="classGraphGridLayout_1a18e195ead36f039589a0abd16c518a64"></span>void <code class="sig-name descname">setParentBetweenDirectChild</code><span class="sig-paren">(</span>bool <em>enabled</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N15GraphGridLayout27setParentBetweenDirectChildEb" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp function">
<dt id="_CPPv4N15GraphGridLayout31setverticalBlockAlignmentMiddleEb">
<span id="_CPPv3N15GraphGridLayout31setverticalBlockAlignmentMiddleEb"></span><span id="_CPPv2N15GraphGridLayout31setverticalBlockAlignmentMiddleEb"></span><span id="GraphGridLayout::setverticalBlockAlignmentMiddle__b"></span><span class="target" id="classGraphGridLayout_1a6471a4f402afa86147f412bd85d1e11c"></span>void <code class="sig-name descname">setverticalBlockAlignmentMiddle</code><span class="sig-paren">(</span>bool <em>enabled</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N15GraphGridLayout31setverticalBlockAlignmentMiddleEb" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp function">
<dt id="_CPPv4N15GraphGridLayout21setLayoutOptimizationEb">
<span id="_CPPv3N15GraphGridLayout21setLayoutOptimizationEb"></span><span id="_CPPv2N15GraphGridLayout21setLayoutOptimizationEb"></span><span id="GraphGridLayout::setLayoutOptimization__b"></span><span class="target" id="classGraphGridLayout_1a4bc1da2a32385487fad48bbe5d000804"></span>void <code class="sig-name descname">setLayoutOptimization</code><span class="sig-paren">(</span>bool <em>enabled</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N15GraphGridLayout21setLayoutOptimizationEb" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
    <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="https://cutter.re/">
          <img class="logo" src="../../_static/cutter.ico" alt="Logo"/>
        </a></p>
      <a href="../../index.html">Cutter documentation</a>
<h3><a href="../../index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../shortcuts.html">Shortcuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../common-errors.html">Common errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers-docs.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-docs.html">User documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../api.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../commonlist.html">Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../corelist.html">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialogslist.html">Dialogs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../menuslist.html">Menus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginslist.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../srclist.html">Src</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../widgetslist.html">Widgets</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
    </div>
  </div>

      <div class="clearer"></div>
    </div>

    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, The Cutter Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
    

  </body>
</html>